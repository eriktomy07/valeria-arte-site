---
const { obra } = Astro.props;
const precio = new Intl.NumberFormat("es-UY").format(obra.precioUYU || 0);

const esVendido = obra.estado?.toLowerCase() === "vendido";
const esReservado = obra.estado?.toLowerCase() === "reservado";

const colorBadge = esVendido
  ? "bg-rose-100 text-rose-700 border-rose-200"
  : esReservado
  ? "bg-amber-100 text-amber-700 border-amber-200"
  : "bg-emerald-100 text-emerald-700 border-emerald-200";

const WHATSAPP_NUMBER = "59894746670";
const wa = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(
  `Hola Valeria, me interesa la obra "${obra.titulo}".`
)}`;
const mail = `mailto:erikspangenberg.uy@gmail.com?subject=${encodeURIComponent(
  `Consulta obra ${obra.titulo}`
)}`;
---

<article class="rounded-2xl shadow-lg bg-white hover:shadow-xl transition-shadow overflow-hidden">
  <div class="relative">
    <a href={`/obra/${obra.id}`} aria-label={`Ver obra ${obra.titulo}`}>
      <img
        src={obra.imagen}
        alt={`Obra ${obra.titulo}`}
        loading="lazy"
        decoding="async"
        class="w-full aspect-[4/3] object-cover transition-transform duration-300 hover:scale-[1.02]"
      />
    </a>
    <span class={`absolute left-3 top-3 border text-xs px-2 py-1 rounded-full ${colorBadge}`}>
      {obra.estado ?? "Estado"}
    </span>
  </div>

  <div class="p-4 space-y-2">
    <h3 class="text-lg font-semibold tracking-tight">
      <a href={`/obra/${obra.id}`} class="hover:underline">{obra.titulo}</a>
    </h3>

    <p class="text-sm text-slate-600">
      {obra.tecnica} • {obra.medidas} • {obra.ano}
    </p>

    <p class="text-sm font-medium">
      {esVendido ? "Vendido" : esReservado ? "Reservado" : `\$${precio} UYU`}
    </p>

    <div class="flex gap-2 pt-2">
      <a
        href={wa}
        target="_blank"
        rel="noreferrer"
        class={`inline-flex items-center justify-center px-4 py-2 rounded-full text-sm font-medium transition-colors
                ${esVendido ? "bg-slate-200 text-slate-500 cursor-not-allowed" : "bg-blue-500 text-white hover:bg-blue-600"}`}
        aria-disabled={esVendido}
        onclick={esVendido ? 'event.preventDefault()' : undefined}
      >
        {esVendido ? "No disponible" : "Consultar"}
      </a>

      <a
        href={mail}
        class="inline-flex items-center justify-center px-4 py-2 rounded-full text-sm font-medium
               border border-slate-200 text-slate-800 hover:bg-slate-50"
      >
        Email
      </a>
    </div>
  </div>
</article>